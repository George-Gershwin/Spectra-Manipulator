

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>spectrum &mdash; Simple Spectra Manipulator 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Simple Spectra Manipulator
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apireference.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Simple Spectra Manipulator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>spectrum</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for spectrum</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># from sys import platform</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">savgol_filter</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.fftpack</span> <span class="k">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">fftfreq</span>

<span class="c1"># import lmfit</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">numba</span> <span class="k">import</span> <span class="n">jit</span>


<span class="c1"># from typing import Union, List, Iterable</span>


<span class="k">class</span> <span class="nc">CalcMode</span><span class="p">:</span>
    <span class="n">add_sub</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mul_div</span> <span class="o">=</span> <span class="mi">1</span>


<div class="viewcode-block" id="Spectrum"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum">[docs]</a><span class="k">class</span> <span class="nc">Spectrum</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class that holds the spectrum object as a 2D array (dimensions n x 2) where n is a number</span>
<span class="sd">        of points in spectrum and includes various functions used for data manipulation with them.</span>
<span class="sd">        Spectrum is stored in variable *data* as a numpy ndarray.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : {numpy.ndarray, None}</span>
<span class="sd">            This argument represents data, this must be 2D numpy array.</span>
<span class="sd">            First column must contain x values and second y values. Data are automatically sorted according to</span>
<span class="sd">            first column.</span>
<span class="sd">        filepath : str, optional</span>
<span class="sd">            The path to the file the spectrum was imported from.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of the spectrum.</span>
<span class="sd">        group_name : str, optional</span>
<span class="sd">            Group name of the spectrum (if inside group).</span>
<span class="sd">        color : {str, tuple}, optional</span>
<span class="sd">            Color of the spectrum, use string for common colors (eg. &#39;black&#39;, &#39;blue&#39;, &#39;red&#39;, ...)</span>
<span class="sd">            or tuple - red, green, blue, alpha components from 0 - 255, eg. (255, 0, 0, 255).</span>
<span class="sd">            If None, user defined color scheme will be used.</span>
<span class="sd">        line_width : {int, float}, optional</span>
<span class="sd">            Sets the line width of the plotted line. If None, user defined color scheme will be used.</span>
<span class="sd">        line_type : int 0-6, optional</span>
<span class="sd">            Sets the line type of the plotted line. See https://doc.qt.io/archives/qt-4.8/qt.html#PenStyle-enum</span>
<span class="sd">            for line types. If None, user defined color scheme will be used.</span>
<span class="sd">        plot_legend : bool</span>
<span class="sd">            Sets, if legend will be plotted for this spectrum.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        data : numpy.ndarray</span>
<span class="sd">            A raw data of spectrum object, dimensions are (n x 2) where n is a number of points in spectrum.</span>
<span class="sd">            First column represents *x* values, second column *y* values.</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spectrum as is displayed in Tree Widget.</span>
<span class="sd">        filepath : {str, None}</span>
<span class="sd">            If the spectrum was imported from file, this variable stored the path to the file it was imported from.</span>
<span class="sd">        color : {str, tuple, None}</span>
<span class="sd">            Color of the spectrum.</span>
<span class="sd">        line_width : {int, float, None}</span>
<span class="sd">            Line width of the plotted line.</span>
<span class="sd">        line_type : {int 0-6, None}</span>
<span class="sd">            Line type.</span>
<span class="sd">        plot_legend : bool</span>
<span class="sd">            If True, name of this spectrum will be added to legend. If False, legend will not contain this spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sort according to first column,numpy matrix, 1. column wavelength, 2. column absorbance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">group_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span> <span class="o">=</span> <span class="n">line_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_type</span> <span class="o">=</span> <span class="n">line_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_legend</span> <span class="o">=</span> <span class="n">plot_legend</span>

<div class="viewcode-block" id="Spectrum.from_xy_values"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.from_xy_values">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xy_values</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the Spectrum object from separate x and y data variables. The dimensions of x_values</span>
<span class="sd">        and y_values must be the same and contain numbers. The other parameters are the same</span>
<span class="sd">        as for __init__ method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_values : iterable, eg. list, tuple, ndarray</span>
<span class="sd">            Iterable that represents x values.</span>
<span class="sd">        y_values : iterable, eg. list, tuple, ndarray</span>
<span class="sd">            Iterable that represents y values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : :class:`Spectrum`</span>
<span class="sd">            Spectrum object.</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If *x_values* or *y_values* have not the same dimension or do not contain numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_values</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of x_values and y_values must match.&quot;</span><span class="p">)</span>

            <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Argument error, x_values and y_values must be iterables and contain numbers.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                   <span class="n">line_type</span><span class="o">=</span><span class="n">line_type</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="n">plot_legend</span><span class="p">)</span></div>

<div class="viewcode-block" id="Spectrum.add_to_list"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.add_to_list">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds this spectrum to the Tree Widget. Only works in SSM&#39;s Console Widget.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">user_namespace</span> <span class="k">import</span> <span class="n">add_to_list</span>
            <span class="n">add_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_redraw_all_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Spectrum.set_plot_legend"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.set_plot_legend">[docs]</a>    <span class="k">def</span> <span class="nf">set_plot_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets whether to plot legend for this spectrum or not.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot_legend : bool</span>
<span class="sd">            Default True.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_legend</span> <span class="o">=</span> <span class="n">plot_legend</span>
        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span></div>

<div class="viewcode-block" id="Spectrum.set_style"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.set_style">[docs]</a>    <span class="k">def</span> <span class="nf">set_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color, line width and line type of plotted spectrum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color : {str, tuple}, optional</span>
<span class="sd">            Color of the spectrum, use string for common colors (eg. &#39;black&#39;, &#39;blue&#39;, &#39;red&#39;, ...)</span>
<span class="sd">            or tuple - red, green, blue, alpha components from 0 - 255, eg. (255, 0, 0, 255).</span>
<span class="sd">            If None (default), user defined color scheme will be used.</span>
<span class="sd">        line_width : {int, float}, optional</span>
<span class="sd">            Sets the line width of the plotted line. If None (default), user defined color scheme will be used.</span>
<span class="sd">        line_type : int 0-6, optional</span>
<span class="sd">            Sets the line type of the plotted line. See https://doc.qt.io/archives/qt-4.8/qt.html#PenStyle-enum</span>
<span class="sd">            for line types. If None (default), user defined color scheme will be used.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if color is not None:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="c1"># if line_width is not None:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span> <span class="o">=</span> <span class="n">line_width</span>
        <span class="c1"># if line_type is not None:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_type</span> <span class="o">=</span> <span class="n">line_type</span>
        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="c1"># from user_namespace import redraw_all_spectra</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span></div>

<div class="viewcode-block" id="Spectrum.set_default_style"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.set_default_style">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets `color`, `line_width` and `line_type` to None. User defined color scheme will be used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="c1"># from user_namespace import redraw_all_spectra</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span></div>

<div class="viewcode-block" id="Spectrum.x_values"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.x_values">[docs]</a>    <span class="k">def</span> <span class="nf">x_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the x values in this spectrum.</span>

<span class="sd">        :return: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Spectrum.y_values"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.y_values">[docs]</a>    <span class="k">def</span> <span class="nf">y_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the y values in this spectrum.</span>

<span class="sd">        :return: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Spectrum.length"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.length">[docs]</a>    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of point that this spectrum has.</span>

<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Spectrum.x_min"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.x_min">[docs]</a>    <span class="k">def</span> <span class="nf">x_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the the first x value.</span>

<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Spectrum.x_max"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.x_max">[docs]</a>    <span class="k">def</span> <span class="nf">x_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the the last x value.</span>

<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Spectrum.spacing"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.spacing">[docs]</a>    <span class="k">def</span> <span class="nf">spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a type and spacing of the x values:</span>
<span class="sd">            * r - probably regular spacing for all points</span>
<span class="sd">            * i - probably irregular spacing for all points</span>

<span class="sd">        The r/i distinction is made by checking differences between first and the end x values.</span>
<span class="sd">        Value is computed as average spacing:  x_max - x_min / number of points</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_dif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">x_dif</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># regular spacing</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># probably irregular spacing, difference between first two and last two x values is not equal</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>

        <span class="k">return</span> <span class="nb">type</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:.3g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span></div>

    <span class="c1"># https://stackoverflow.com/questions/15382076/plotting-power-spectrum-in-python</span>
<div class="viewcode-block" id="Spectrum.power_spectrum"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.power_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">power_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the power spectrum using FFT and replaces the data values. Power spectrum is normalized to 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn (and Tree View updated).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># number of points in current spectrum</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">vals</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="nb">filter</span> <span class="o">=</span> <span class="n">freq</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="c1"># pick only frequencies &gt;= 0</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">freq</span><span class="p">[</span><span class="nb">filter</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="nb">filter</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">output</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Spectrum.savitzky_golay"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.savitzky_golay">[docs]</a>    <span class="k">def</span> <span class="nf">savitzky_golay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="n">poly_order</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies Savitysky-Golay filter to a spectrum. Based on `scipy.signal.savgol_filter &lt;https://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.signal.savgol_filter.html&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window_length : int</span>
<span class="sd">            Length of window that is used in the algorithm, must be positive odd integer.</span>
<span class="sd">        poly_order : int</span>
<span class="sd">            Polynomial order used in the algorithm, must be &gt;= 1.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn (and Tree View updated).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_length</span><span class="p">)</span>
        <span class="n">poly_order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">poly_order</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">poly_order</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Polynomial order must be &gt; 0.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">poly_order</span> <span class="o">&gt;=</span> <span class="n">window_length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Polynomial order must be less than window_length.&quot;</span><span class="p">)</span>

        <span class="c1"># window_length must be odd number</span>
        <span class="k">if</span> <span class="n">window_length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">window_length</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">window_length</span><span class="p">,</span> <span class="n">poly_order</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Spectrum.derivative"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.derivative">[docs]</a>    <span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates a derivative spectrum and replaces the values. Length of the spectrum decreases by 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn (and Tree View updated).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">_derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="nd">@staticmethod</span>
    <span class="nd">@jit</span><span class="p">(</span><span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_derivative</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">der_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">der_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">der_data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>  <span class="c1"># dy/dx</span>

        <span class="k">return</span> <span class="n">der_data</span>

<div class="viewcode-block" id="Spectrum.integrate"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integrates the spectrum using trapezoidal integration method, spectrum y values will</span>
<span class="sd">        be replaced by integrated values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        int_constant : {int, float}</span>
<span class="sd">            Integration constant, default 0.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">_integrate_trap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">int_constant</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="nd">@staticmethod</span>
    <span class="nd">@jit</span><span class="p">(</span><span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_integrate_trap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">int_constant</span><span class="p">):</span>
        <span class="n">int_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">int_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">int_constant</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="n">int_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dx</span>
            <span class="n">int_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span>

        <span class="n">int_data</span><span class="p">[:]</span> <span class="o">/=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">int_data</span>

<div class="viewcode-block" id="Spectrum.integral"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.integral">[docs]</a>    <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate cumulative integral of spectrum at specified x range [x0, x1] by trapezoidal integration method.</span>
<span class="sd">        If x0, x1 are None, all spectrum will be integrated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float, None}</span>
<span class="sd">            First x value. If both x0 and x1 are None, all spectrum will be integrated.</span>
<span class="sd">        x1 : {int, float, None}</span>
<span class="sd">            Last x value. If both x0 and x1 are None, all spectrum will be integrated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : float</span>
<span class="sd">            Integral.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># not exactly end index, this is actually end_index + 1</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Argument error, x0 (</span><span class="si">{x0}</span><span class="s2">) cannot be larger or equal than x1 (</span><span class="si">{x1}</span><span class="s2">).&quot;</span><span class="p">)</span>

            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">)</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># cca 3 orders of magnitude faster than pythonic version</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">_integral_trap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="nd">@jit</span><span class="p">(</span><span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_integral_trap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="c1"># perform trapezodic integration, assuming the data are unevenly distributed,</span>
        <span class="c1"># so no simplification in computation, except the division by 2 at the end</span>
        <span class="c1"># numba likes a lot of indexes</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dx</span>

        <span class="k">return</span> <span class="nb">sum</span> <span class="o">/</span> <span class="mi">2</span>

<div class="viewcode-block" id="Spectrum.baseline_correct"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.baseline_correct">[docs]</a>    <span class="k">def</span> <span class="nf">baseline_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtracts the average of y data from the specified x range [x0, x1] from y values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            First x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            Last x value.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;</span> <span class="n">x1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Argument error, x0 (</span><span class="si">{x0}</span><span class="s2">) cannot be larger than x1 (</span><span class="si">{x1}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="c1"># get nearby indexes of user defined x values</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># calculate the average of y values over the selected range</span>
        <span class="n">avrg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># subtract the average from y values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">avrg</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Spectrum.normalize"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds an y maximum at specified x range [x0, x1] and divide all y values by this maximum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            First x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            Last x value.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;</span> <span class="n">x1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Argument error, x0 (</span><span class="si">{x0}</span><span class="s2">) cannot be larger than x1 (</span><span class="si">{x1}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="c1"># get nearby indexes of user defined x values</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># normalize y values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">y_max</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Spectrum.find_maximum"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.find_maximum">[docs]</a>    <span class="k">def</span> <span class="nf">find_maximum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a point (x and y value), which belongs to a maximum y value in a specified x range [x0, x1].</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float, None}</span>
<span class="sd">            First x value. If both x0 and x1 are None, all spectrum will be searched.</span>
<span class="sd">        x1 : {int, float, None}</span>
<span class="sd">            Last x value. If both x0 and x1 are None, all spectrum will be searched.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : tuple - (x, y)</span>
<span class="sd">            A highest point in spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># not exactly end index, this is actually end_index + 1</span>

        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Argument error, x0 (</span><span class="si">{x0}</span><span class="s2">) cannot be larger or equal than x1 (</span><span class="si">{x1}</span><span class="s2">).&quot;</span><span class="p">)</span>

            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">)</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">max_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># return the x a y max value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">max_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">max_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Spectrum.interpolate"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.interpolate">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolates the spectrum, based on `scipy.interpolation.interp1d &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spacing : {int, float}</span>
<span class="sd">            Sets the spacing between output x values, default 1.</span>
<span class="sd">        kind : str</span>
<span class="sd">            Sets the kind of interpolation method used, eg. &#39;linear&#39;, &#39;quadratic&#39;, etc. For more, refer to</span>
<span class="sd">            `interp1d documentation &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d&gt;`_.</span>
<span class="sd">            Default &#39;linear&#39;.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn (and Tree View updated).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">data_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">spacing</span> <span class="o">&gt;</span> <span class="n">data_max</span> <span class="o">-</span> <span class="n">data_min</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Spacing (</span><span class="si">{spacing}</span><span class="s2">) cannot be larger that data itself. &quot;</span>
                             <span class="n">f</span><span class="s2">&quot;Resample method, spectrum </span><span class="si">{self.name}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># new x data must lie inside a range of original x values</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">data_min</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">))</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">data_max</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">))</span>

        <span class="c1"># length of array of new data</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">new_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># new x values</span>

        <span class="c1"># interp1d returns a function that takes x values as the argument and returns the interpolated y values</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">assume_sorted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">new_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">new_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># interpolate the y values</span>

        <span class="c1"># change the reference of self.data to new_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">new_data</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Spectrum.cut"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cuts the spectrum to x range [x0, x1].</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            First x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            Last x value.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn (and Tree View updated).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Argument error, x0 (</span><span class="si">{x0}</span><span class="s2">) cannot be larger or equal than x1 (</span><span class="si">{x1}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="c1"># get nearby indexes of user defined x values</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">end_idx</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Oh... someone likes to cut a lot, but with these input parameters, resulting spectrum would have&quot;</span>
                <span class="s2">&quot; 1 point :). Unfortunately, cannot perform cut operation.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Spectrum.extend_by_zeros"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.extend_by_zeros">[docs]</a>    <span class="k">def</span> <span class="nf">extend_by_zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">redraw_spectra</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extends this spectrum to a new x range [x0, x1] by zeros. The original data will</span>
<span class="sd">        be replaced. Spacing will be determined from current data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            New fist x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            New last x value.</span>
<span class="sd">        redraw_spectra : bool</span>
<span class="sd">            If True (default), spectra will be redrawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Argument error, x0 (</span><span class="si">{x0}</span><span class="s2">) cannot be larger or equal than x1 (</span><span class="si">{x1}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_min</span><span class="p">()</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">()</span>

        <span class="c1"># get nearby indexes of user defined x values</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x0</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">start_idx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">end_idx</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># nothing to extend</span>
            <span class="k">return</span>
            <span class="c1"># raise ValueError(&quot;Nothing to extend.&quot;)</span>

        <span class="n">x_dif</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">x_dif</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">new_x_min</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x0</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">min_stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">x_min</span> <span class="o">-</span> <span class="n">new_x_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">min_lin_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">new_x_min</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_min</span><span class="p">)</span>

            <span class="n">min_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_min</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">min_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_lin_space</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">min_stack</span> <span class="o">=</span> <span class="n">min_stack</span><span class="o">.</span><span class="n">T</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">max_stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_x_max</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x1</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">num_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">new_x_max</span> <span class="o">-</span> <span class="n">x_max</span><span class="p">)</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">max_lin_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">new_x_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_max</span><span class="p">)</span>

            <span class="n">max_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_max</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">max_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_lin_space</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">max_stack</span> <span class="o">=</span> <span class="n">max_stack</span><span class="o">.</span><span class="n">T</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">min_stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">min_stack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">max_stack</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">min_stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">min_stack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">max_stack</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">redraw_spectra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_operation_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the shapes of self and other data array are the same and where</span>
<span class="sd">        first and last x value is the same. If not, raises ValueError.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;Spectra &#39;</span><span class="si">{self.name}</span><span class="s2">&#39; and &#39;</span><span class="si">{other.name}</span><span class="s2">&#39; have not the same length (dimension). &quot;</span>
                <span class="s2">&quot;Unable to perform calculation.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;Spectra &#39;</span><span class="si">{self.name}</span><span class="s2">&#39; and &#39;</span><span class="si">{other.name}</span><span class="s2">&#39; have different x ranges. &quot;</span>
                <span class="s2">&quot;Unable to perform calculation.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_arithmetic_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">add_sub</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform calculation of Spectrum with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># another spectrum</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operation_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># number</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">CalcMode</span><span class="o">.</span><span class="n">add_sub</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">add_sub</span><span class="p">)</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other_data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> + </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">add_sub</span><span class="p">)</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">other_data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">mul_div</span><span class="p">)</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">other_data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> * </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">mul_div</span><span class="p">)</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">other_data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">add_sub</span><span class="p">)</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="n">other_data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> + </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform calculation of Spectrum with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ret_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span> <span class="o">-</span> <span class="n">ret_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">CalcMode</span><span class="o">.</span><span class="n">mul_div</span><span class="p">)</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="n">other_data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> * </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform calculation of Spectrum with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
        <span class="n">ret_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ret_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span> <span class="o">/</span> <span class="n">ret_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">ret_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;-</span><span class="si">{self.name}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">sp</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">modulo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># self ** power</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">power</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="p">(</span><span class="n">Spectrum</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform calculation of Spectrum with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">power</span><span class="p">)))</span>

        <span class="n">x_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># another spectrum</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operation_check</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>

            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">power</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_xy_values</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1"> ** </span><span class="si">{power.name}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># number</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">power</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_xy_values</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1"> ** </span><span class="si">{power}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>  <span class="c1"># other ** self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">Spectrum</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform calculation of Spectrum with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

        <span class="n">x_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># another spectrum</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operation_check</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_xy_values</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{other.name}</span><span class="s1"> ** </span><span class="si">{self.name}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># number</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_xy_values</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{other}</span><span class="s1"> ** </span><span class="si">{self.name}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">float_to_string</span><span class="p">(</span><span class="n">float_number</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">float_number</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">new_line</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;Wavelength&quot;</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">new_line</span> <span class="k">if</span> <span class="n">include_header</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">buffer</span> <span class="o">+=</span> <span class="n">new_line</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">float_to_string</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buffer</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_list_to_stream</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">,</span> <span class="n">include_group_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">decimal_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">save_to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">x_data_name</span><span class="o">=</span><span class="s1">&#39;Wavelength / nm&#39;</span><span class="p">):</span>

        <span class="c1"># this generator iterates the ndarray data and yield returns a list of formatted row for csv writer</span>
        <span class="k">def</span> <span class="nf">iterate_data</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;list_of_spectra&#39; must be type of list.&quot;</span><span class="p">)</span>

        <span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">dialect</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">excel</span>
        <span class="n">dialect</span><span class="o">.</span><span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>
        <span class="n">dialect</span><span class="o">.</span><span class="n">lineterminator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">dialect</span><span class="o">.</span><span class="n">quoting</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">save_to_file</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">else</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group_name</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span>
                                        <span class="p">(</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;Untitled</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">dialect</span><span class="o">=</span><span class="n">dialect</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">dialect</span><span class="p">)</span>

            <span class="c1"># export as group</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">include_group_name</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group_name</span><span class="p">])</span>

                <span class="c1"># add header if it is user defined</span>
                <span class="k">if</span> <span class="n">include_header</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">x_data_name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">node</span><span class="p">])</span>

                <span class="c1"># add row of wavelength, then, we will transpose the matrix, otherwise, we would have to reshape</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># add absorbance data to matrix from all exported spectra</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sp</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">!=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">():</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="n">f</span><span class="s2">&quot;Spectra &#39;</span><span class="si">{node[0].name}</span><span class="s2">&#39; and &#39;</span><span class="si">{sp.name}</span><span class="s2">&#39; in group &#39;</span><span class="si">{node[0].group_name}</span><span class="s2">&#39;&quot;</span>
                            <span class="n">f</span><span class="s2">&quot; have not the same length (dimension). Unable to export.&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">sp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="n">f</span><span class="s2">&quot;Spectra &#39;</span><span class="si">{node[0].name}</span><span class="s2">&#39; and &#39;</span><span class="si">{sp.name}</span><span class="s2">&#39; in group &#39;</span><span class="si">{node[0].group_name}</span><span class="s2">&#39;&quot;</span>
                            <span class="n">f</span><span class="s2">&quot; have not the same length (dimension). Unable to export.&quot;</span><span class="p">)</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">matrix</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>

                <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># transpose</span>

                <span class="c1"># write matrix</span>
                <span class="n">w</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">iterate_data</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>

            <span class="c1"># export as single spectrum file</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">include_header</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">x_data_name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

                <span class="n">w</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">iterate_data</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">save_to_file</span><span class="p">:</span>
                <span class="n">buffer</span> <span class="o">+=</span> <span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">buffer</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="c1"># return ret_buffer and remove the 2 new line characters that are at the end</span>
            <span class="k">return</span> <span class="n">buffer</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_to_files</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">extension</span><span class="p">,</span> <span class="n">include_group_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                      <span class="n">decimal_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">x_data_name</span><span class="o">=</span><span class="s1">&#39;Wavelength / nm&#39;</span><span class="p">):</span>

        <span class="n">Spectrum</span><span class="o">.</span><span class="n">_list_to_stream</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">,</span> <span class="n">include_group_name</span><span class="p">,</span> <span class="n">include_header</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span>
                                 <span class="n">decimal_sep</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">extension</span><span class="p">,</span> <span class="n">x_data_name</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_to_string</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">,</span> <span class="n">include_group_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="n">decimal_sep</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">x_data_name</span><span class="o">=</span><span class="s1">&#39;Wavelength / nm&#39;</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">_list_to_stream</span><span class="p">(</span><span class="n">list_of_spectra</span><span class="p">,</span> <span class="n">include_group_name</span><span class="p">,</span> <span class="n">include_header</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span>
                                        <span class="n">decimal_sep</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">x_data_name</span><span class="o">=</span><span class="n">x_data_name</span><span class="p">)</span>

<div class="viewcode-block" id="Spectrum.find_nearest_idx"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.find_nearest_idx">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_nearest_idx</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds nearest index of `value` in `array`. If value &gt;  max(array), the last index of array</span>
<span class="sd">        is returned, if value &lt; min(array), 0 is returned. Array must be sorted.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : ndarray</span>
<span class="sd">            Array to be searched.</span>
<span class="sd">        value : {int, float}</span>
<span class="sd">            Value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : int</span>
<span class="sd">            Found nearest index to value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">])):</span>
            <span class="k">return</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="Spectrum.find_nearest"><a class="viewcode-back" href="../spectrum.html#spectrum.Spectrum.find_nearest">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_nearest</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns closest value in in `array`. If value &gt;  max(array), the last value of array</span>
<span class="sd">        is returned, if value &lt; min(array), first value of array is returned. Array must be sorted.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : ndarray</span>
<span class="sd">            Array to be searched.</span>
<span class="sd">        value : {int, float}</span>
<span class="sd">            Value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : type of values in `array`</span>
<span class="sd">            Found nearest value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deep copy the current instance as Spectrum object.&quot;&quot;&quot;</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_type</span><span class="p">)</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sp</span></div>


<div class="viewcode-block" id="SpectrumList"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList">[docs]</a><span class="k">class</span> <span class="nc">SpectrumList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class that holds a group of spectra as a list and enables simple arithmetic calculations among groups of spectra, number and</span>
<span class="sd">        group and spectrum and group. It acts as a list, so the individual spectra can be accessed by putting square brackets</span>
<span class="sd">        after the instance of an object and putting appropriate index in them. Also, spectrum objects can be iterated the same way as list.</span>
<span class="sd">        Also, it enables other calculations on the group of spectra, like baseline correction, cutting, basically all the</span>
<span class="sd">        operation provided in :class:`Spectrum` class plus additional operations that can</span>
<span class="sd">        be only used for groups, like transposition, etc. ....</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        children : {list, None}</span>
<span class="sd">            List of :class:`Spectrum`, default None.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The group name.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        children : list of :class:`Spectrum`</span>
<span class="sd">            List of members in this group.</span>
<span class="sd">        name : str</span>
<span class="sd">            The group name as appeared in Tree Widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">children</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>

<div class="viewcode-block" id="SpectrumList.add_to_list"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.add_to_list">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds this group to the Tree Widget. Only works in SSM&#39;s Console Widget.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spectra : {list, None}</span>
<span class="sd">            If None, current members will be added, otherwise, spectra will be imported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">user_namespace</span> <span class="k">import</span> <span class="n">add_to_list</span>
            <span class="n">add_to_list</span><span class="p">(</span><span class="bp">self</span> <span class="k">if</span> <span class="n">spectra</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">spectra</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_redraw_all_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="SpectrumList.get_names"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.get_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns names of all Spectrum objects as a list.</span>

<span class="sd">        :returns: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">()]</span></div>

<div class="viewcode-block" id="SpectrumList.set_names"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.set_names">[docs]</a>    <span class="k">def</span> <span class="nf">set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the names of the group and updates the Tree Widget and redraws the spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names : iterable, eg. list, tuple</span>
<span class="sd">            New names that will be replaced. The length of names can be different from number</span>
<span class="sd">            of spectra in group (using a zip function).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects in list have to be type of Spectrum.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

        <span class="c1"># from user_namespace import update_view, redraw_all_spectra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span></div>

<div class="viewcode-block" id="SpectrumList.set_plot_legend"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.set_plot_legend">[docs]</a>    <span class="k">def</span> <span class="nf">set_plot_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets whether to plot legend for this group or not and redraws all spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot_legend : bool</span>
<span class="sd">            Default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">set_plot_legend</span><span class="p">(</span><span class="n">plot_legend</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span></div>

<div class="viewcode-block" id="SpectrumList.set_style"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.set_style">[docs]</a>    <span class="k">def</span> <span class="nf">set_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets color, line width and line type of all group and redraws all spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color : {str, tuple}, optional</span>
<span class="sd">            Color of the spectrum, use string for common colors (eg. &#39;black&#39;, &#39;blue&#39;, &#39;red&#39;, ...)</span>
<span class="sd">            or tuple - red, green, blue, alpha components from 0 - 255, eg. (255, 0, 0, 255).</span>
<span class="sd">            If None (default), user defined color scheme will be used.</span>
<span class="sd">        line_width : {int, float}, optional</span>
<span class="sd">            Sets the line width of the plotted line. If None (default), user defined color scheme will be used.</span>
<span class="sd">        line_type : int 0-6, optional</span>
<span class="sd">            Sets the line type of the plotted line. See https://doc.qt.io/archives/qt-4.8/qt.html#PenStyle-enum</span>
<span class="sd">            for line types. If None (default), user defined color scheme will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">line_width</span><span class="p">,</span> <span class="n">line_type</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_iterate_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects in list have to be type of Spectrum.&quot;</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">sp</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">node</span>
                <span class="k">continue</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects in list have to be type of Spectrum.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SpectrumList.derivative"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.derivative">[docs]</a>    <span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates a derivatives for this group, replaces the values and redraws the spectra.</span>
<span class="sd">        Length of the spectrum decreases by 1 and redraws the spectra.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.integrate"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_constant</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integrates the group of spectra using trapezoidal integration method, spectra&#39;s y values will</span>
<span class="sd">        be replaced by integrated values and redraws the spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        int_constant : {int, float}</span>
<span class="sd">            Integration constant, default 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">int_constant</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.integral"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.integral">[docs]</a>    <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates cumulative integral for each spectrum in this group at specified x range [x0, x1] by trapezoidal integration method.</span>
<span class="sd">        If x0, x1 are None, all spectra will be integrated. Result is returned as ndarray.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float, None}</span>
<span class="sd">            First x value. If both x0 and x1 are None, all spectra will be integrated.</span>
<span class="sd">        x1 : {int, float, None}</span>
<span class="sd">            Last x value. If both x0 and x1 are None, all spectra will be integrated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : numpy.ndarray</span>
<span class="sd">            Array of integrals.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>

<div class="viewcode-block" id="SpectrumList.find_maximum"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.find_maximum">[docs]</a>    <span class="k">def</span> <span class="nf">find_maximum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an array of points (x and y value), which belongs to a maximum y value in a specified x range [x0, x1].</span>
<span class="sd">        First column contains x values, the second y values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float, None}</span>
<span class="sd">            First x value. If both x0 and x1 are None, all spectra will be searched.</span>
<span class="sd">        x1 : {int, float, None}</span>
<span class="sd">            Last x value. If both x0 and x1 are None, all spectra will be searched.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : ndarray</span>
<span class="sd">            A highest points in spectra.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">find_maximum</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>

<div class="viewcode-block" id="SpectrumList.get_y_values_at_x"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.get_y_values_at_x">[docs]</a>    <span class="k">def</span> <span class="nf">get_y_values_at_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns y values at particular x value as an ndarray in this group of spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : {int, float}</span>
<span class="sd">            The x value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : ndarray</span>
<span class="sd">            Array of y values at this x value.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ret_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">find_nearest_idx</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ret_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ret_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>

<div class="viewcode-block" id="SpectrumList.transpose"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.transpose">[docs]</a>    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transposes group, names of spectra in group will be taken as x values for transposed data, so these values</span>
<span class="sd">        must be convertible to int or float numbers. No text is allowed in these cells, only values.</span>
<span class="sd">        All x values of spectra in the group will become names in new group. The transposed group is added to Tree Widget.</span>
<span class="sd">        The operation is basically the same as copying the group of spectra to Excel, performs transposition of the matrix</span>
<span class="sd">        and copying back to SSM.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_items : int</span>
<span class="sd">            Maximum number of items that will be added. If the transposition produce more than *max_items*,</span>
<span class="sd">            ValueError will be raised. Default 1000.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least 2 items have to be in the group in order to perform transposition.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects in list have to be type of Spectrum.&quot;</span><span class="p">)</span>

        <span class="n">x_vals_temp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x_vals_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names of spectra cannot be parsed to float.&quot;</span><span class="p">)</span>

        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_vals_temp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># wavelengths</span>

        <span class="c1"># add absorbance data to matrix from all exported spectra</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sp</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Spectra </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2"> and </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2"> have not the same length (dimension). &quot;</span>
                    <span class="s2">&quot;Unable to transpose.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">matrix</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="n">group_name</span> <span class="o">=</span> <span class="s2">&quot;Transpose of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">spectra</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Number of transposed items (</span><span class="si">{}</span><span class="s2">) exceeded the maximum number (</span><span class="si">{}</span><span class="s2">). Cannot transpose spectra.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_items</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_xy_values</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]),</span> <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">)</span>
            <span class="n">spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_list</span><span class="p">([</span><span class="n">spectra</span><span class="p">])</span></div>

<div class="viewcode-block" id="SpectrumList.power_spectrum"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.power_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">power_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the power spectrum using FFT and replaces the data values and redraws the spectra. Power spectrum is normalized to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">power_spectrum</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.savitzky_golay"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.savitzky_golay">[docs]</a>    <span class="k">def</span> <span class="nf">savitzky_golay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="n">poly_order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies Savitysky-Golay filter to a group of spectra and redraws the spectra. Based on `scipy.signal.savgol_filter &lt;https://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.signal.savgol_filter.html&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window_length : int</span>
<span class="sd">            Length of window that is used in the algorithm, must be positive odd integer.</span>
<span class="sd">        poly_order : int</span>
<span class="sd">            Polynomial order used in the algorithm, must be &gt;= 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">savitzky_golay</span><span class="p">(</span><span class="n">window_length</span><span class="p">,</span> <span class="n">poly_order</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.baseline_correct"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.baseline_correct">[docs]</a>    <span class="k">def</span> <span class="nf">baseline_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtracts the average of y data from the specified x range [x0, x1] from y values for each spectrum in</span>
<span class="sd">        this group and redraws the spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            First x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            Last x value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">baseline_correct</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.cut"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cuts all spectra in this group to x range [x0, x1] and redraws the spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            First x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            Last x value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.interpolate"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.interpolate">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolates the spectra in this group and redraws them, based on `scipy.interpolation.interp1d &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spacing : {int, float}</span>
<span class="sd">            Sets the spacing between output x values, default 1.</span>
<span class="sd">        kind : str</span>
<span class="sd">            Sets the kind of interpolation method used, eg. &#39;linear&#39;, &#39;quadratic&#39;, etc. For more, refer to</span>
<span class="sd">            `interp1d documentation &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d&gt;`_.</span>
<span class="sd">            Default &#39;linear&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">spacing</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.normalize"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds an y maximum at specified x range [x0, x1] and divide all y values by this maximum. This</span>
<span class="sd">        operation is perfomred for each spectrum in this group. The spectra are redrawn.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            First x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            Last x value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SpectrumList.extend_by_zeros"><a class="viewcode-back" href="../spectrum.html#spectrum.SpectrumList.extend_by_zeros">[docs]</a>    <span class="k">def</span> <span class="nf">extend_by_zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extends spectra in this group to a new x range [x0, x1] by zeros and redraws the spectra. The original data will</span>
<span class="sd">        be replaced. Spacing will be determined from data of current spectrum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x0 : {int, float}</span>
<span class="sd">            New fist x value.</span>
<span class="sd">        x1 : {int, float}</span>
<span class="sd">            New last x value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_items</span><span class="p">():</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">extend_by_zeros</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_all_spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_arithmetic_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">func_operation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform an defined operation on groups of spectra (type Spectrum). func_operation is a pointer to function.</span>
<span class="sd">        This function takes 2 arguments that must be type of Spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># operation with another list, group + group</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SpectrumList</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform an operation on groups which contains different number of items.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SpectrumList</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Spectrum</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects in list have to be type of Spectrum.&quot;</span><span class="p">)</span>
            <span class="n">ret_list</span> <span class="o">=</span> <span class="n">SpectrumList</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">ret_list</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">other</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">ret_list</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># operation with single spectrum, group + spectrum or with number, eg. group - 1</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">Spectrum</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SpectrumList</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Spectrum</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects in list have to be type of Spectrum.&quot;</span><span class="p">)</span>
            <span class="n">ret_list</span> <span class="o">=</span> <span class="n">SpectrumList</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">ret_list</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_operation</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">ret_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="k">else</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot perform calculation of SpectrumList with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> + </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">s2</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> * </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s1</span> <span class="o">/</span> <span class="n">s2</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s2</span> <span class="o">+</span> <span class="n">s1</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> + </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s2</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">s1</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> * </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s2</span> <span class="o">/</span> <span class="n">s1</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="n">SpectrumList</span><span class="p">()</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;-</span><span class="si">{self.name}</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">modulo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># self ** power</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s1</span> <span class="o">**</span> <span class="n">s2</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> ** </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>  <span class="c1"># other ** self</span>
        <span class="nb">list</span><span class="p">,</span> <span class="n">other_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arithmetic_operation</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s2</span> <span class="o">**</span> <span class="n">s1</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> ** </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deep copy this instance as SpectrumList.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">SpectrumList</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">__copy__</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Dominik Madea

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>